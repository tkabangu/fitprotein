{% extends 'base.html.twig' %}

{% block title product.title %}


{% block body %}

    <!--Shop Single Section-->
    <section class="shop-single-section">
        <div class="auto-container">

            <!--Shop Single-->
            <div class="shop-page product-details">

                <!--Basic Details-->
                <div class="basic-details">
                    <div class="row clearfix">

                        <div class="image-column col-lg-6 col-md-12 col-sm-12">
                            <div class="carousel-outer">

                                {% if product.pictures is not empty %}

                                <ul class="image-carousel owl-carousel owl-theme">
                                    {% for picture in product.pictures %}
                                        <li><a href="{{ asset('/images/products/'~ picture.filename) }}" class="lightbox-image" title="Image Caption Here"><img src="{{ '/images/products/'~ picture.filename }}" width="300px"></a></li>
                                    {% endfor %}
                                    </ul>

                                    <ul class="thumbs-carousel owl-carousel owl-theme">
                                        {% for picture in product.pictures %}
                                            <li><img src="{{ '/images/products/'~ picture.filename }}"></li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}


                            </div>
                        </div>

                        <!--Info Column-->
                        <div class="info-column col-lg-6 col-md-12 col-sm-12">
                            <div class="details-header">
                                <h2>{{ product.title }}</h2>
                                <div class="rating"><span class="fa fa-star"></span> <span class="fa fa-star"></span> <span class="fa fa-star"></span> <span class="fa fa-star"></span> <span class="fa fa-star"></span></div>
                                <div class="item-price">Price: {{ product.price }}€</div>
                            </div>

                            <div class="text">
                                <p>{{ product.description | nl2br }}</p>
                            </div>

                            <div class="other-options">
                                <div class="clearfix">
                                    <div class="pull-left">
                                        <div class="item-quantity"><input class="item-quantity quantity-spinner" type="text" value="1" name="quantity" data-max="{{ product.quantity }}"></div>
                                    </div>
                                    <div class="pull-left">
                                        <!--Btns Box-->
                                        <div class="btns-box">
                                            <button type="button" class="add-to-cart btn btn-primary" data-id="{{ product.id }}" data-filename="{{ product.picture.filename }}" data-name="{{ product.title }}" data-price="{{ product.price }}" ><span class="txt">Add To Cart</span></button>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <ul class="shop-list">

                                <li><strong>Rémise</strong><span class="theme_color">.</span>{{ product.discount }} %</li>
                                <li><strong>Quantité</strong><span class="theme_color">.</span>{{ product.quantity }}</li>
                                <hr>

                                <li><strong>SKU</strong><span class="theme_color">.</span>25087900</li>
                                <li><strong>Category</strong><span class="theme_color">.</span>Branding, Web Design</li>
                                <li><strong>share</strong><span class="theme_color">.</span></li>
                                <li><a href="#">Add to Wishlist .</a></li>
                            </ul>

                        </div>

                    </div>
                </div>
                <!--Basic Details-->

                <!--Product Info Tabs-->
                <div class="product-info-tabs">
                    <!--Product Tabs-->
                    <div class="prod-tabs tabs-box">

                        <!--Tab Btns-->
                        <ul class="tab-btns tab-buttons clearfix">
                            <li data-tab="#prod-details" class="tab-btn active-btn">Description</li>
                            <li data-tab="#prod-info" class="tab-btn">Additional Information</li>
                            <li data-tab="#prod-reviews" class="tab-btn">Reviews (2)</li>
                        </ul>
                        <!--Tabs Container-->
                        <div class="tabs-content">
                            <!--Tab-->
                            <div class="tab" id="prod-reviews">
                                <!--Reviews Container-->
                                <div class="reviews-container">

                                    <!--Review-->
                                    <div class="review-box clearfix">
                                        <figure class="rev-thumb"><img src="https://via.placeholder.com/270x300" alt=""></figure>
                                        <div class="rev-content">
                                            <div class="rev-header clearfix">
                                                <h4>Michel Britney</h4>
                                                <div class="rating"><span class="fa fa-star"></span> <span class="fa fa-star"></span> <span class="fa fa-star"></span> <span class="far fa-star"></span> <span class="far fa-star"></span></div>
                                                <div class="time">18 Hours Ago</div>
                                            </div>
                                            <div class="rev-text">The mad lightning no one you beat of just one drum they call him Flipper Flipper faster than lightning no one you see is smarter each week my friends you are sure to get a smile from seven stranded cast aways here on Gilligans Isle they call him Flipper Flipper faster.</div>
                                        </div>
                                    </div>



                                    <!--Add Review-->
                                    <div class="add-review">
                                        <h2>Add a Review</h2>

                                        <form method="post" action="shop-single.html">
                                            <div class="row clearfix">
                                                <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                                    <label>Name *</label>
                                                    <input type="text" name="name" value="" placeholder="" required>
                                                </div>
                                                <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                                    <label>Email *</label>
                                                    <input type="email" name="email" value="" placeholder="" required>
                                                </div>
                                                <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                                    <label>Website *</label>
                                                    <input type="text" name="website" value="" placeholder="" required>
                                                </div>
                                                <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                                    <label>Rating </label>
                                                    <div class="rating">
                                                        <a href="#" class="rate-box" title="1 Out of 5"><span class="fa fa-star"></span></a>
                                                        <a href="#" class="rate-box" title="2 Out of 5"><span class="fa fa-star"></span> <span class="fa fa-star"></span></a>
                                                        <a href="#" class="rate-box" title="3 Out of 5"><span class="fa fa-star"></span> <span class="fa fa-star"> </span> <span class="fa fa-star"></span></a>
                                                        <a href="#" class="rate-box" title="4 Out of 5"><span class="fa fa-star"></span> <span class="fa fa-star"></span> <span class="fa fa-star"></span> <span class="fa fa-star"></span></a>
                                                        <a href="#" class="rate-box" title="5 Out of 5"><span class="fa fa-star"></span> <span class="fa fa-star"></span> <span class="fa fa-star"></span> <span class="fa fa-star"></span> <span class="fa fa-star"></span></a>
                                                    </div>
                                                </div>
                                                <div class="form-group col-md-12 col-sm-12 col-xs-12">
                                                    <label>Your Review</label>
                                                    <textarea name="review-message"></textarea>
                                                </div>
                                                <div class="form-group text-right col-md-12 col-sm-12 col-xs-12">
                                                    <button type="button" class="theme-btn btn-style-three"><span class="txt">Add Review</span></button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>

                                </div>
                            </div>
                            <!--End Tab-->

                        </div>
                    </div>

                </div>
                <!--End Product Info Tabs-->


            </div>

        </div>
    </section>
    <!--End Shop Single Section-->


    <!-- Modal -->
    <div class="modal fade" id="cart" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Cart</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <table class="show-cart table">

                    </table>
                    <div>Total price: $<span class="total-cart"></span></div>
                </div>
                <div class="modal-footer">

                    <button class="clear-cart btn btn-danger pull-left">Clear Cart</button>

                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Order now</button>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

 {% block javascript_footer %}

     <script src="{{ asset('assets/js/script.js') }}"></script>

     <script type="text/javascript">


         $("input[name='quantity']").TouchSpin({
             min: 0,
             max: $(this).data('max')
         });

         var shoppingCart = (function() {
             // =============================
             // Private methods and propeties
             // =============================
             var cart = [];

             // Constructor
             function Item(id, count, filename, name, price) {
                 this.id = id;
                 this.filename = filename;
                 this.name = name;
                 this.price = price;
                 this.count = count;
             }

             // Save cart
             function saveCart() {
                 sessionStorage.setItem('shoppingCart2', JSON.stringify(cart));
             }

             // Load cart
             function loadCart() {
                 cart = JSON.parse(sessionStorage.getItem('shoppingCart2'));
             }
             if (sessionStorage.getItem("shoppingCart2") != null) {
                 loadCart();
             }


             // =============================
             // Public methods and propeties
             // =============================
             var obj = {};

             // Add to cart
             obj.addItemToCart = function(id,count, filename, name, price) {

                 for(var item in cart) {
                     if(cart[item].id === id) {
                         var tmp = parseFloat(cart[item].count, 10) + parseFloat(count, 10);
                         cart[item].count = tmp;
                         saveCart();
                         return;
                     }
                 }
                 var item = new Item(id, count, filename, name, price);
                 cart.push(item);
                 saveCart();
             }
             // Set count from item
             obj.setCountForItem = function(id, count) {
                 for(var i in cart) {
                     if (cart[i].id === id) {
                         cart[i].count = count;
                         break;
                     }
                 }
             };
             // Remove item from cart
             obj.removeItemFromCart = function(id) {
                 for(var item in cart) {
                     if(cart[item].id === id) {
                         cart[item].count --;
                         if(cart[item].count === 0) {
                             cart.splice(item, 1);
                         }
                         break;
                     }
                 }
                 saveCart();
             }

             // Add item to cart
             obj.addItem2Cart = function(id) {
                 for(var item in cart) {
                     if(cart[item].id === id) {
                         cart[item].count ++;
                         if(cart[item].count === 0) {
                             cart.splice(item, 1);
                         }
                         break;
                     }
                 }
                 saveCart();
             }

             // Remove all items from cart
             obj.removeItemFromCartAll = function(id) {
                 for(var item in cart) {
                     if(cart[item].id === id) {
                         cart.splice(item, 1);
                         break;
                     }
                 }
                 saveCart();
             }

             // Clear cart
             obj.clearCart = function() {
                 cart = [];
                 saveCart();
             }

             // Count cart
             obj.totalCount = function() {
                 var totalCount = 0;
                 for(var item in cart) {
                     totalCount += cart[item].count;
                 }
                 return totalCount;
             }

             // Total cart
             obj.totalCart = function() {
                 var totalCart = 0;
                 for(var item in cart) {
                     totalCart += cart[item].price * cart[item].count;
                 }
                 return Number(totalCart.toFixed(2));
             }

             // List cart
             obj.listCart = function() {
                 var cartCopy = [];
                 for(i in cart) {
                     item = cart[i];
                     itemCopy = {};
                     for(p in item) {
                         itemCopy[p] = item[p];

                     }
                     itemCopy.total = Number(item.price * item.count).toFixed(2);
                     cartCopy.push(itemCopy)
                 }
                 return cartCopy;
             }

             // cart : Array
             // Item : Object/Class
             // addItemToCart : Function
             // removeItemFromCart : Function
             // removeItemFromCartAll : Function
             // clearCart : Function
             // countCart : Function
             // totalCart : Function
             // listCart : Function
             // saveCart : Function
             // loadCart : Function
             return obj;
         })();


         // Add item
         $('.add-to-cart').click(function(event) {
             event.preventDefault();
             var id = $(this).data('id');
             var filename = $(this).data('filename');
             var name = $(this).data('name');
             var price = Number($(this).data('price'));
             var count = $(this).parent().parent().parent().find('input.item-quantity').val();
             shoppingCart.addItemToCart(id, count, filename, name, price);
             displayCart();
         });

         // Clear items
         $('.clear-cart').click(function() {
             shoppingCart.clearCart();
             displayCart();
         });


         function displayCart() {
             var cartArray = shoppingCart.listCart();
             var output = "";
             for(var i in cartArray) {
                 output += "<tr>"
                     + "<td><img src='/images/products/"+ cartArray[i].filename + "' width='50px'></td>"
                     + "<td>" + cartArray[i].name + "</td>"
                     + "<td>(" + cartArray[i].price + ")</td>"
                     + "<td><div class='input-group'><button class='minus-item input-group-addon btn btn-primary' data-id=" + cartArray[i].id + ">-</button>"
                     + "<input type='number' class='item-count form-control' data-id='" + cartArray[i].id + "' value='" + cartArray[i].count + "'>"
                     + "<button class='plus-item btn btn-primary input-group-addon' data-id=" + cartArray[i].id + ">+</button></div></td>"
                     + "<td><button class='delete-item btn btn-danger' data-id=" + cartArray[i].id + ">X</button></td>"
                     + " = "
                     + "<td>" + cartArray[i].total + "</td>"
                     +  "</tr>";
             }
             $('.show-cart').html(output);
             $('.total-cart').html(shoppingCart.totalCart());
             $('.total-count').html(shoppingCart.totalCount());
         }

         // Delete item button

         $('.show-cart').on("click", ".delete-item", function(event) {
             var id = $(this).data('id')
             shoppingCart.removeItemFromCartAll(id);
             displayCart();
         })


         // -1
         $('.show-cart').on("click", ".minus-item", function(event) {
             var id = $(this).data('id');
             shoppingCart.removeItemFromCart(id);
             displayCart();
         })
         // +1
         $('.show-cart').on("click", ".plus-item", function(event) {
             var id = $(this).data('id');
             shoppingCart.addItem2Cart(id);
             displayCart();
         })

         // Item count input
         $('.show-cart').on("change", ".item-count", function(event) {
             var id = $(this).data('id');
             var count = Number($(this).val());
             shoppingCart.setCountForItem(id, count);
             displayCart();
         });

         displayCart();


     </script>

{% endblock %}
